console.log('LENG BOT V.1.0');
const svgDAttribute = 'M 38.859375 19.003906 C 38.859375 19.003906 28.863281 18.800781 18.503906 26.707031 C 18.390625 26.789062 18.296875 26.898438 18.230469 27.023438 C 18.230469 27.023438 7.996094 45.851562 7.996094 69.144531 C 8 69.332031 8.050781 69.515625 8.152344 69.675781 C 8.152344 69.675781 15.015625 80.484375 30.964844 81 C 31.328125 81.011719 31.671875 80.824219 31.855469 80.515625 L 34.855469 75.515625 C 35.011719 75.253906 35.042969 74.9375 34.9375 74.652344 C 34.832031 74.367188 34.601562 74.144531 34.3125 74.050781 C 29.722656 72.519531 26.875 69.992188 25.132812 67.914062 C 29.699219 70.339844 38.285156 74 50 74 C 61.714844 74 70.300781 70.339844 74.863281 67.914062 C 73.125 69.992188 70.277344 72.519531 65.683594 74.050781 C 65.394531 74.148438 65.167969 74.367188 65.0625 74.652344 C 64.957031 74.9375 64.988281 75.253906 65.140625 75.515625 L 68.140625 80.515625 C 68.328125 80.824219 68.667969 81.011719 69.03125 81 C 84.980469 80.484375 91.847656 69.675781 91.847656 69.675781 C 91.949219 69.515625 92 69.332031 92 69.144531 C 92 45.847656 81.769531 27.023438 81.769531 27.023438 C 81.703125 26.898438 81.609375 26.789062 81.496094 26.707031 C 71.136719 18.800781 61.140625 19.003906 61.140625 19.003906 C 60.910156 19.007812 60.6875 19.089844 60.507812 19.242188 L 59.347656 20.242188 C 59.070312 20.480469 58.945312 20.847656 59.019531 21.203125 C 59.09375 21.558594 59.355469 21.847656 59.703125 21.957031 C 64.144531 23.335938 67.3125 25.039062 69.894531 26.664062 C 64.136719 24.460938 57.632812 23 50 23 C 42.367188 23 35.863281 24.460938 30.105469 26.664062 C 32.6875 25.039062 35.855469 23.335938 40.296875 21.957031 C 40.644531 21.847656 40.90625 21.558594 40.980469 21.203125 C 41.054688 20.847656 40.929688 20.480469 40.652344 20.242188 L 39.488281 19.242188 C 39.3125 19.09375 39.089844 19.007812 38.859375 19.003906 Z M 37.109375 21.101562 C 32.503906 22.839844 28.800781 24.839844 26.429688 26.589844 C 23.589844 28.683594 22.222656 30.375 22.222656 30.375 C 21.921875 30.746094 21.929688 31.277344 22.238281 31.644531 C 22.542969 32.007812 23.070312 32.105469 23.488281 31.875 C 30.671875 27.867188 39.175781 25 50 25 C 60.824219 25 69.328125 27.867188 76.515625 31.875 C 76.929688 32.105469 77.457031 32.007812 77.761719 31.644531 C 78.070312 31.277344 78.078125 30.746094 77.78125 30.375 C 77.78125 30.375 76.410156 28.683594 73.570312 26.589844 C 71.203125 24.839844 67.5 22.839844 62.894531 21.101562 C 65.972656 21.402344 72.84375 22.699219 80.109375 28.179688 C 80.402344 28.730469 89.894531 46.621094 89.984375 68.832031 C 89.570312 69.476562 83.644531 78.238281 69.527344 78.9375 L 67.453125 75.476562 C 75.910156 72.144531 78.921875 65.394531 78.921875 65.394531 C 79.097656 64.980469 78.976562 64.5 78.625 64.21875 C 78.273438 63.9375 77.777344 63.925781 77.414062 64.191406 C 77.414062 64.191406 66.6875 72 50 72 C 33.3125 72 22.589844 64.191406 22.589844 64.191406 C 22.222656 63.925781 21.726562 63.9375 21.375 64.21875 C 21.023438 64.5 20.902344 64.980469 21.082031 65.394531 C 21.082031 65.394531 24.089844 72.144531 32.546875 75.476562 L 30.472656 78.9375 C 16.355469 78.238281 10.429688 69.476562 10.015625 68.832031 C 10.105469 46.617188 19.597656 28.722656 19.894531 28.175781 C 27.15625 22.695312 34.03125 21.402344 37.109375 21.101562 Z M 50 28 C 41.105469 28 32.996094 30.082031 25.261719 34.332031 C 25.101562 34.417969 24.996094 34.578125 24.992188 34.761719 C 24.988281 34.941406 25.082031 35.109375 25.234375 35.203125 C 25.390625 35.296875 25.582031 35.296875 25.742188 35.207031 C 33.339844 31.035156 41.261719 29 50 29 C 55.023438 29 59.777344 29.699219 64.359375 31.066406 C 64.527344 31.117188 64.714844 31.070312 64.84375 30.949219 C 64.972656 30.824219 65.027344 30.640625 64.988281 30.46875 C 64.945312 30.292969 64.8125 30.15625 64.644531 30.105469 C 59.96875 28.710938 55.117188 28 50 28 Z M 66.464844 30.722656 C 66.226562 30.734375 66.027344 30.917969 65.996094 31.15625 C 65.964844 31.394531 66.105469 31.621094 66.335938 31.699219 C 68.007812 32.277344 69.660156 32.929688 71.289062 33.699219 C 71.449219 33.78125 71.644531 33.769531 71.796875 33.667969 C 71.945312 33.5625 72.03125 33.386719 72.011719 33.203125 C 71.996094 33.023438 71.878906 32.863281 71.714844 32.792969 C 70.046875 32.007812 68.363281 31.339844 66.664062 30.75 C 66.601562 30.730469 66.535156 30.71875 66.464844 30.722656 Z M 73.492188 33.757812 C 73.261719 33.753906 73.058594 33.914062 73.003906 34.140625 C 72.953125 34.367188 73.058594 34.597656 73.265625 34.703125 C 73.613281 34.882812 73.949219 35.039062 74.257812 35.210938 C 74.417969 35.296875 74.609375 35.296875 74.765625 35.203125 C 74.917969 35.109375 75.011719 34.941406 75.007812 34.761719 C 75.003906 34.578125 74.898438 34.417969 74.738281 34.332031 C 74.390625 34.140625 74.050781 33.984375 73.730469 33.816406 C 73.660156 33.777344 73.574219 33.753906 73.492188 33.757812 Z M 37.5 46 C 32.78125 46 29 50.074219 29 55 C 29 59.925781 32.78125 64 37.5 64 C 42.21875 64 46 59.925781 46 55 C 46 50.074219 42.21875 46 37.5 46 Z M 62.5 46 C 57.78125 46 54 50.074219 54 55 C 54 59.925781 57.78125 64 62.5 64 C 67.21875 64 71 59.925781 71 55 C 71 50.074219 67.21875 46 62.5 46 Z M 37.5 48 C 41.066406 48 44 51.089844 44 55 C 44 58.910156 41.066406 62 37.5 62 C 33.933594 62 31 58.910156 31 55 C 31 51.089844 33.933594 48 37.5 48 Z M 62.5 48 C 66.066406 48 69 51.089844 69 55 C 69 58.910156 66.066406 62 62.5 62 C 58.933594 62 56 58.910156 56 55 C 56 51.089844 58.933594 48 62.5 48 Z M 62.5 48 ';
const LENG_BOT_API = 'https://titan-leng-bot.herokuapp.com';
const X_API_KEY = 'kQaWVJdbfIXALytpnFeI';
// const successNotification = Toastify({
//   text: "Shared to Mahasiswa Santai",
//   duration: 3000,
//   gravity: "bottom", // `top` or `bottom`,
//   close: false,
//   position: 'center', // `left`, `center` or `right`
//   backgroundColor: "#1EA2F1",
//   stopOnFocus: true, // Prevents dismissing of toast on hover
// });


function sendToDiscord(linkToTweet) {

  $.ajax({
    method: 'POST',
    url: `${LENG_BOT_API}/share/url`,
    headers: {
      'x-api-key': X_API_KEY
    },
    dataType: 'JSON',
    data: { url: linkToTweet },
    success: (data) => {
      Toastify({
          text: "Shared to Mahasiswa Santai",
          duration: 3000,
          gravity: "bottom", // `top` or `bottom`,
          close: false,
          position: 'center', // `left`, `center` or `right`
          backgroundColor: "#1EA2F1",
          stopOnFocus: true, // Prevents dismissing of toast on hover
        }).showToast();
    },
    error: (err) => {
      console.log(err)
      Toastify({
        text: "Failed to Share",
        duration: 3000,
        gravity: "bottom", // `top` or `bottom`,
        close: false,
        position: 'center', // `left`, `center` or `right`
        backgroundColor: "#FF3333",
        stopOnFocus: true, // Prevents dismissing of toast on hover
      }).showToast()
    }
  });
}

$('body').on('click', function(event){
  let isShareButtonClicked = document.documentElement.innerText.toLowerCase().indexOf('send via direct message') > -1;
  if(isShareButtonClicked) {
    return;
  }
  setTimeout(function(){
    isShareButtonClicked = document.documentElement.innerText.toLowerCase().indexOf('send via direct message') > -1;
    if(isShareButtonClicked){
      const identifierElement = document.querySelector("[role='menuitem']");
      const shareToDiscord = identifierElement.cloneNode(true);
      let targetEvent = $(event.target);
      if(targetEvent.prop('tagName').toLowerCase() !=='svg') {
        targetEvent = $(event.target.parentElement.getElementsByTagName('svg')[0]);

      }
      const aElements = [...targetEvent.parents()[9].childNodes[0].getElementsByTagName('a')];
      const selectedAElement = aElements.filter(value => value.href.includes('/status/')).shift();
      const linkToTweet = selectedAElement.href;
      console.log(linkToTweet);
      shareToDiscord.getElementsByTagName('span')[0].innerText = 'Share to Mahasiswa Santai';
      const svg = shareToDiscord.getElementsByTagName('svg')[0];
      const g = svg.getElementsByTagName('g')[0];
      const path = g.getElementsByTagName('path')[0];
      svg.setAttribute('viewBox', '10 10 100 100');
      svg.setAttribute('height', '18pt');
      svg.setAttribute('width', '18pt');
      svg.setAttribute('style', 'margin-right:2')
      g.setAttribute('id', 'surface6261460');
      path.setAttribute('style', 'stroke:none;fill-rule:nonzero;fill:rgb(136%,100%,100%);fill-opacity:1;');
      path.setAttribute('d', svgDAttribute);
      shareToDiscord.addEventListener('click', (event) => {
        parentElement.remove();
        return sendToDiscord(linkToTweet);
      });
      const parentElement = identifierElement.parentElement
      parentElement.append(shareToDiscord);
    }
  }, 200);
});